---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: workloadplans.score.dev
spec:
  group: score.dev
  names:
    kind: WorkloadPlan
    listKind: WorkloadPlanList
    plural: workloadplans
    shortNames:
    - wplan
    singular: workloadplan
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: PHASE
      type: string
    - jsonPath: .spec.runtimeClass
      name: RUNTIME
      type: string
    - jsonPath: .spec.workloadRef.name
      name: WORKLOAD
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: AGE
      type: date
    name: v1b1
    schema:
      openAPIV3Schema:
        description: |-
          WorkloadPlan is an internal contract from Orchestrator to the Runtime controller.
          It must not be user-visible via RBAC.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              WorkloadPlanSpec contains the runtime class and the materialization plan.
              All fields are internal; users should not rely on their concrete shape.
            properties:
              claims:
                description: Claims declares resource requirements to be materialized
                  by the runtime.
                items:
                  description: |-
                    PlanClaim declares a claim requirement passed to the runtime controller.
                    It mirrors the resolution keys (type/class/params) used by resolvers.
                  properties:
                    class:
                      description: Class is the resource class (e.g., "dev", "prod",
                        "large").
                      type: string
                    key:
                      description: Key is the logical key (e.g., "db", "cache").
                      type: string
                    params:
                      description: Params contains extra provisioning parameters (opaque
                        to Score).
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    type:
                      description: Type is the resource type (e.g., "postgres", "redis").
                      type: string
                  required:
                  - key
                  - type
                  type: object
                type: array
              observedWorkloadGeneration:
                description: ObservedWorkloadGeneration is the generation of the Workload
                  used to compute this plan.
                format: int64
                type: integer
              resolvedValues:
                description: |-
                  ResolvedValues contains fully resolved final values with all placeholders substituted.
                  Runtime controllers should use this as the single source of truth for template values.
                  Format: { containers: { <name>: { env: { <key>: <value|valueFrom> }}}, service: {...}, ... }
                  Note: CEL validation for placeholder prevention is not implemented due to RawExtension type limitations
                type: object
                x-kubernetes-preserve-unknown-fields: true
              runtimeClass:
                description: RuntimeClass is the selected runtime controller class.
                type: string
              template:
                description: Template contains the reference and type information
                  for runtime materialization.
                properties:
                  kind:
                    description: 'Kind is the template type: "manifests" | "helm"
                      | "kustomize"'
                    type: string
                  ref:
                    description: Ref is the immutable reference (OCI digest recommended)
                    type: string
                  values:
                    description: Values are optional default template values
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                required:
                - kind
                - ref
                type: object
              workloadRef:
                description: WorkloadRef identifies the source Workload of this plan.
                properties:
                  name:
                    description: Name is the Workload name.
                    type: string
                  namespace:
                    description: Namespace is the Workload namespace.
                    type: string
                required:
                - name
                - namespace
                type: object
            required:
            - observedWorkloadGeneration
            - runtimeClass
            - workloadRef
            type: object
          status:
            description: WorkloadPlanStatus represents the observed state of a WorkloadPlan.
            properties:
              conditions:
                description: Conditions represent the current state of the WorkloadPlan.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              message:
                description: Message provides human-readable status information.
                type: string
              phase:
                description: Phase indicates the current state of the runtime provisioning.
                enum:
                - Pending
                - Provisioning
                - Ready
                - Failed
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
